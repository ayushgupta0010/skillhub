"use strict";(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[366],{11053:function(ve,w,a){a.r(w),a.d(w,{default:function(){return te}});var W=a(15009),u=a.n(W),B=a(97857),S=a.n(B),H=a(99289),v=a.n(H),D=a(5574),A=a.n(D),J=a(2393),I=a(2618),g=a(76772);function K(h,n){return C.apply(this,arguments)}function C(){return C=v()(u()().mark(function h(n,o){return u()().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return y.abrupt("return",(0,g.request)("/api/login/captcha",S()({method:"GET",params:S()({},n)},o||{})));case 1:case"end":return y.stop()}},h)})),C.apply(this,arguments)}var Q=a(87547),$=a(94149),X=a(24454),Y=a(88641),q=a(68262),P=a(5966),_=a(16434),ee=a(38925),x=a(2453),ae=a(11941),U=a(67610),k=a(67294),se=a(73935),re=a(28846),e=a(85893),Z=(0,re.kc)(function(h){var n=h.token;return{action:{marginLeft:"8px",color:"rgba(0, 0, 0, 0.2)",fontSize:"24px",verticalAlign:"middle",cursor:"pointer",transition:"color 0.3s","&:hover":{color:n.colorPrimaryActive}},lang:{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:n.borderRadius,":hover":{backgroundColor:n.colorBgTextHover}},container:{display:"flex",flexDirection:"column",height:"100vh",overflow:"auto",backgroundImage:"url('https://mdn.alipayobjects.com/yuyan_qk0oxh/afts/img/V-_oS6r-i7wAAAAAAAAAAAAAFl94AQBr')",backgroundSize:"100% 100%"}}}),Me=function(){var n=Z(),o=n.styles;return _jsxs(_Fragment,{children:[_jsx(AlipayCircleOutlined,{className:o.action},"AlipayCircleOutlined"),_jsx(TaobaoCircleOutlined,{className:o.action},"TaobaoCircleOutlined"),_jsx(WeiboCircleOutlined,{className:o.action},"WeiboCircleOutlined")]})},ye=function(){var n=Z(),o=n.styles;return _jsx("div",{className:o.lang,"data-lang":!0,children:SelectLang&&_jsx(SelectLang,{})})},F=function(n){var o=n.content;return(0,e.jsx)(ee.Z,{style:{marginBottom:24},message:o,type:"error",showIcon:!0})},ne=function(){var n,o,p,y=(0,k.useState)({}),O=A()(y,2),N=O[0],ie=O[1],le=(0,k.useState)("account"),R=A()(le,2),j=R[0],oe=R[1],z=(0,g.useModel)("@@initialState"),M=z.initialState,ue=z.setInitialState,ce=(0,g.useSearchParams)(),E=A()(ce,2),de=E[0],je=E[1],ge=Z(),fe=ge.styles,f=(0,g.useIntl)(),G=function(){var m=v()(u()().mark(function t(){var r,i;return u()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,M==null||(r=M.fetchUserInfo)===null||r===void 0?void 0:r.call(M);case 2:i=l.sent,i&&(0,se.flushSync)(function(){ue(function(L){return S()(S()({},L),{},{currentUser:i})})});case 4:case"end":return l.stop()}},t)}));return function(){return m.apply(this,arguments)}}(),me=function(){var m=v()(u()().mark(function t(r){var i,s,l;return u()().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.prev=0,c.next=3,(0,I.ZA)(S()({},r));case 3:if(i=c.sent,!i.success){c.next=8;break}return s=i.message,x.ZP.success(s),c.abrupt("return");case 8:console.log(i),c.next=16;break;case 11:c.prev=11,c.t0=c.catch(0),l=f.formatMessage({id:"pages.login.failure",defaultMessage:"Login failed, please try again!"}),console.log(c.t0),x.ZP.error(l);case 16:case"end":return c.stop()}},t,null,[[0,11]])}));return function(r){return m.apply(this,arguments)}}(),pe=function(){var m=v()(u()().mark(function t(r){var i,s,l,L;return u()().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.prev=0,d.next=3,(0,I.JS)({email:r.username,password:r.password});case 3:if(i=d.sent,!i.token){d.next=13;break}return localStorage.setItem("auth_token",i.token),s=f.formatMessage({id:"pages.login.success",defaultMessage:"Login successful!"}),x.ZP.success(s),d.next=10,G();case 10:return l=new URL(window.location.href).searchParams,g.history.push(l.get("redirect")||"/"),d.abrupt("return");case 13:console.log(i),ie(i),d.next=22;break;case 17:d.prev=17,d.t0=d.catch(0),L=f.formatMessage({id:"pages.login.failure",defaultMessage:"Login failed, please try again!"}),console.log(d.t0),x.ZP.error(L);case 22:case"end":return d.stop()}},t,null,[[0,17]])}));return function(r){return m.apply(this,arguments)}}(),T=N.status,b=N.type,he=function(){var m=v()(u()().mark(function t(){var r;return u()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(r=de.get("t"),!(r&&r.length>0)){s.next=7;break}return localStorage.setItem("auth_token",r),s.next=5,G();case 5:return g.history.push("/"),s.abrupt("return");case 7:case"end":return s.stop()}},t)}));return function(){return m.apply(this,arguments)}}();he();var V=((n=U.Z.site)===null||n===void 0||(n=n.theme)===null||n===void 0?void 0:n.title)==="SeaORM Pro"||location.hostname==="sea-orm-pro-demo.sea-ql.org";return(0,e.jsxs)("div",{className:fe.container,children:[(0,e.jsx)(g.Helmet,{children:(0,e.jsxs)("title",{children:[f.formatMessage({id:"menu.login",defaultMessage:"Login"}),"- ",(o=U.Z.site)===null||o===void 0||(o=o.theme)===null||o===void 0?void 0:o.title]})}),(0,e.jsx)("div",{style:{flex:"1",padding:"32px 0"},children:(0,e.jsxs)(q.U,{contentStyle:{minWidth:280,maxWidth:"75vw"},initialValues:{autoLogin:!0},onFinish:function(){var m=v()(u()().mark(function t(r){return u()().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(j!=="email"){s.next=5;break}return s.next=3,me(r);case 3:s.next=8;break;case 5:if(j!=="account"){s.next=8;break}return s.next=8,pe(r);case 8:case"end":return s.stop()}},t)}));return function(t){return m.apply(this,arguments)}}(),children:[(0,e.jsx)("div",{style:{display:"flex",justifyContent:"center"},children:(0,e.jsx)("img",{alt:"logo",src:M==null||(p=M.settings)===null||p===void 0||(p=p.site)===null||p===void 0||(p=p.theme)===null||p===void 0?void 0:p.login_banner,style:{width:"300px"}})}),(0,e.jsx)(ae.Z,{activeKey:j,onChange:oe,centered:!0,items:[{key:"account",label:f.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"Account Login"})}]}),T==="error"&&b==="account"&&(0,e.jsx)(F,{content:f.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"Incorrect username/password"})}),j==="account"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(P.Z,{name:"username",fieldProps:{size:"large",prefix:(0,e.jsx)(Q.Z,{})},placeholder:f.formatMessage({id:"pages.login.username.placeholder_",defaultMessage:V?"Username: admin@sea-ql.org":"Username"}),rules:[{required:!0,message:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"Please input username!"})}]}),(0,e.jsx)(P.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,e.jsx)($.Z,{})},placeholder:f.formatMessage({id:"pages.login.password.placeholder_",defaultMessage:V?"Password: demo@sea-ql.org":"Password"}),rules:[{required:!0,message:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"Please input password!"})}]})]}),T==="error"&&b==="mobile"&&(0,e.jsx)(F,{content:"Auth code error"}),j==="mobile"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(P.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(X.Z,{})},name:"mobile",placeholder:f.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"Phone Number"}),rules:[{required:!0,message:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"Please input your phone number!"})},{pattern:/^1\d{10}$/,message:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"Phone number is invalid!"})}]}),(0,e.jsx)(_.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)($.Z,{})},captchaProps:{size:"large"},placeholder:f.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"Verification Code"}),captchaTextRender:function(t,r){return t?"".concat(r," ").concat(f.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"sec(s)"})):f.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"Get Code"})},name:"captcha",rules:[{required:!0,message:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"Please input verification code!"})}],onGetCaptcha:function(){var m=v()(u()().mark(function t(r){var i;return u()().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,K({phone:r});case 2:if(i=l.sent,i){l.next=5;break}return l.abrupt("return");case 5:x.ZP.success("Auth Code: 1234");case 6:case"end":return l.stop()}},t)}));return function(t){return m.apply(this,arguments)}}()})]}),T==="error"&&b==="email"&&(0,e.jsx)(F,{content:"Invalid Verification Token"}),j==="email"&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(P.Z,{fieldProps:{size:"large",prefix:(0,e.jsx)(Y.Z,{})},name:"email",placeholder:f.formatMessage({id:"pages.login.email.placeholder",defaultMessage:"Email"}),rules:[{required:!0,message:(0,e.jsx)(g.FormattedMessage,{id:"pages.login.email.required",defaultMessage:"Email Required!"})}]})})]})}),(0,e.jsx)(J.$_,{})]})},te=ne}}]);
